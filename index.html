<!-- FINAL FULL UPGRADED INDEX.HTML WITH WHATSAPP-STYLE MESSAGING + 15 FLIPBOARDS + ADMIN CHAT LIST + DARK MODE + MOBILE RESPONSIVE -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Campus Finder Hub</title>
  <link rel="icon" href="my-logo.png" />

  <style>
    :root {
      --bg: #f5f5f5;
      --text: #000;
      --card: white;
      --header: #0055ff;
    }
    body.dark {
      --bg: #121212;
      --text: #fff;
      --card: #1e1e1e;
      --header: #0a84ff;
    }

    body { margin:0; font-family:Arial; background:var(--bg); color:var(--text);}    
    header { background:var(--header); color:white; padding:15px; text-align:center; font-size:22px; display:flex; justify-content:space-between; align-items:center; }

    #darkSwitch { background:white; padding:5px 12px; border-radius:8px; cursor:pointer; color:black; }

    nav { display:flex; justify-content:space-around; background:var(--card); padding:10px; border-bottom:1px solid #ddd; }
    nav button { background:none; border:none; font-size:18px; padding:8px 12px; cursor:pointer; color:var(--text); }
    nav button.active { color:var(--header); font-weight:bold; position:relative; }

    .badge { position:absolute; top:0; right:-3px; background:red; color:white; font-size:12px; padding:2px 6px; border-radius:50%; }

    .tab{ display:none; padding:20px; }
    .show{ display:block; }

    /* LOGIN POPUP */
    #loginPopup{
      position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);
      display:flex;justify-content:center;align-items:center;z-index:9999;
    }
    #loginBox{ max-width:350px;background:var(--card);padding:20px;border-radius:12px;box-shadow:0 0 10px rgba(0,0,0,.3);}    
    input{ width:100%;padding:10px;margin:8px 0; }

    /* HOME FLIP CARDS */
    .grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; }
    .card{ perspective:1000px; }
    .inner{ position:relative; width:100%; height:180px; transition:0.7s; transform-style:preserve-3d; cursor:pointer; }
    .card:hover .inner{ transform:rotateY(180deg); }
    .front,.back{
      position:absolute;width:100%;height:100%;backface-visibility:hidden;
      display:flex;align-items:center;justify-content:center;border-radius:12px;
      font-size:20px;padding:10px;color:white;
    }
    .front{background:#0077ff;}
    .back{background:#222;transform:rotateY(180deg);flex-direction:column;}
    .back a{ background:white;color:black;padding:6px 12px;border-radius:6px;text-decoration:none;margin-top:10px; }

    /* CHAT */
    #chatMain{ display:flex; gap:20px; }

    /* LEFT USERS LIST */
    #chatUsers{
      width:30%; max-height:400px; overflow-y:auto; background:var(--card); padding:10px; border-radius:12px;
    }
    .chatUser{
      padding:12px; margin:6px 0; background:#dedede; cursor:pointer; border-radius:10px;
    }

    /* RIGHT MESSAGE AREA */
    #chatArea{ width:70%; }

    #chatBox{ height:300px; overflow-y:auto; background:var(--card); padding:10px; border-radius:12px; }
    .bubble{ padding:10px 14px; margin:10px; max-width:70%; border-radius:18px; }
    .me{ background:#0055ff; color:white; margin-left:auto; }
    .other{ background:#999; color:white; margin-right:auto; }
    #typing{ font-size:14px; color:gray; }

    /* PROFILE */
    #profile img{ border-radius:50%; }
    table{ width:100%; background:var(--card); border-radius:12px; }
    th{ background:#0055ff; color:white; padding:10px; }
    td{ padding:10px; }

    /* MOBILE */
    @media(max-width:700px){
      #chatMain{ flex-direction:column; }
      #chatUsers, #chatArea{ width:100%; }
    }
  </style>
</head>
<body>
<header>
  <span>Campus Finder Hub</span>
  <span id="darkSwitch" onclick="toggleDark()">ðŸŒ™</span>
</header>

<nav>
  <button onclick="openTab('home')" class="active">Home</button>
  <button onclick="openTab('messages')">Messages</button>
  <button onclick="openTab('profile')">Profile</button>
</nav>

<!-- LOGIN POPUP -->
<div id="loginPopup">
  <div id="loginBox">
    <h2>Login</h2>
    <input id="email" type="email" placeholder="Email" />
    <input id="password" type="password" placeholder="Password" />
    <button onclick="login()">Login</button>
    <button onclick="signup()">Sign Up</button>
<br>
    <button onclick="googleLogin()">Continue With Google</button>
    <p onclick="resetPassword()" style="color:blue;cursor:pointer;">Forgot Password?</p>
  </div>
</div>

<!-- HOME TAB -->
<div id="home" class="tab show">
  <h2>Explore Colleges</h2>
  <p>Find the best colleges across Tamil Nadu and India. Choose your stream and explore detailed lists.</p>
  <div class="grid" id="cards"></div>
</div>

<!-- MESSAGES TAB -->
<div id="messages" class="tab">
  <h2>Chat</h2>
  <div id="chatMain">

    <!-- LEFT USER LIST (Admin Only) -->
    <div id="chatUsers" style="display:none"></div>

    <!-- RIGHT CHAT AREA -->
    <div id="chatArea">
      <div id="chatBox"></div>
      <div id="typing"></div>

      <textarea id="msg" placeholder="Type..." oninput="sendTyping()" style="width:100%;height:60px"></textarea>
      <button onclick="sendMessage()">Send</button>
    </div>

  </div>
</div>

<!-- PROFILE TAB -->
<div id="profile" class="tab">
  <h2>Your Profile</h2>
  <img id="pfp" src="" width="100" height="100"><br>
  <input id="username" placeholder="Username" />
  <input id="pic" type="file" accept="image/*" />
  <button onclick="saveProfile()">Save Profile</button>

  <div id="adminPanel" style="display:none; margin-top:30px;">
    <h3>Admin Panel</h3>
    <p>Welcome, <b id="adminName"></b></p>
    <p>Manage users & messages below.</p>
  </div>
</div>

<!-- FIREBASE COMPAT -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>

<script>
// INIT
const firebaseConfig={
  apiKey:"AIzaSyDjW_3cYR8apPFMmZqLqZh_9i2bN-1IEmY",
  authDomain:"college-finder-279aa.firebaseapp.com",
  databaseURL:"https://college-finder-279aa-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"college-finder-279aa",
  storageBucket:"college-finder-279aa.appspot.com",
  messagingSenderId:"99165014172",
  appId:"1:99165014172:web:4a45ea931a6e403b53d58e"
};
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.database();
const storage=firebase.storage();

// DARK MODE
function toggleDark(){ document.body.classList.toggle("dark"); }

// TABS
function openTab(tab){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('show'));
  document.getElementById(tab).classList.add('show');
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
}

// AUTH
function login(){ auth.signInWithEmailAndPassword(email.value,password.value); }
function signup(){ auth.createUserWithEmailAndPassword(email.value,password.value); }
function googleLogin(){ auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
function resetPassword(){ auth.sendPasswordResetEmail(email.value); alert("Reset email sent"); }

auth.onAuthStateChanged(user=>{ if(user) init(); });

function init(){
  loginPopup.style.display="none";
  loadProfile();
  loadFlipboards();

  if(auth.currentUser.email=="mithun@admin.com"){
    adminPanel.style.display="block";
    adminName.innerHTML="Mithun (Admin)";
    loadChatUsers();
    chatUsers.style.display="block";
  }

  loadChat();
}

// 15 FLIPBOARDS
const boards=[
  {name:"Engineering - Chennai",file:"eng_chennai.html"},
  {name:"Engineering - Trichy",file:"eng_trichy.html"},
  {name:"Engineering - Coimbatore",file:"eng_coimb.html"},
  {name:"Engineering - Madurai",file:"eng_mdu.html"},
  {name:"Engineering - Erode",file:"eng_erode.html"},
  {name:"Arts - Chennai",file:"arts_chennai.html"},
  {name:"Arts - Trichy",file:"arts_trichy.html"},
  {name:"Arts - Kovai",file:"arts_kovai.html"},
  {name:"Medical - Chennai",file:"med_chennai.html"},
  {name:"Medical - Madurai",file:"med_mdu.html"},
  {name:"Polytechnic",file:"poly.html"},
  {name:"MBA Colleges",file:"mba.html"},
  {name:"Fashion",file:"fashion.html"},
  {name:"Law",file:"law.html"},
  {name:"Agriculture",file:"agri.html"}
];

function loadFlipboards(){
  cards.innerHTML="";
  boards.forEach(b=>{
    cards.innerHTML+=`<div class='card'><div class='inner'><div class='front'>${b.name}</div><div class='back'>${b.name}<a href='${b.file}'>View</a></div></div></div>`;
  })
}

// PROFILE
function loadProfile(){
  let u=auth.currentUser;
  db.ref("users/"+u.uid).once("value").then(s=>{
    let d=s.val();
    if(d){ username.value=d.username||""; if(d.pfp) pfp.src=d.pfp; }
  });
}

function saveProfile(){
  let u=auth.currentUser;
  let file=pic.files[0];
  if(file){
    let ref=storage.ref("pfp/"+u.uid);
    ref.put(file).then(()=>ref.getDownloadURL().then(url=>{
      db.ref("users/"+u.uid).update({username:username.value,pfp:url,email:u.email});
      pfp.src=url;
    }))
  } else {
    db.ref("users/"+u.uid).update({username:username.value,email:u.email});
  }
}

// ADMIN CHAT LIST
function loadChatUsers(){
  db.ref("users").on("value",s=>{
    chatUsers.innerHTML="";
    s.forEach(u=>{
      let d=u.val();
      if(d.email!="mithun@admin.com"){
        chatUsers.innerHTML+=`<div class='chatUser' onclick="openPrivateChat('${u.key}','${d.username}')">${d.username} <br><small>${d.email}</small></div>`;
      }
    })
  })
}

// CHAT
let currentChatUser="admin";

function openPrivateChat(uid,name){
  currentChatUser=uid;
  chatBox.innerHTML="";
  loadChat();
}

function loadChat(){
  let path=(auth.currentUser.email=="mithun@admin.com") ? "chat/"+currentChatUser : "chat/"+auth.currentUser.uid;

  db.ref(path).on("value",s=>{
    chatBox.innerHTML="";
    s.forEach(m=>{
      let d=m.val();
      let me=d.uid==auth.currentUser.uid;
      chatBox.innerHTML+=`<div class='bubble ${me?"me":"other"}'>${d.text}</div>`;
    })
    chatBox.scrollTop=chatBox.scrollHeight;
  })
}

function sendMessage(){
  let u=auth.currentUser;
  let path=(auth.currentUser.email=="mithun@admin.com") ? "chat/"+currentChatUser : "chat/"+u.uid;

  db.ref(path).push({uid:u.uid,text:msg.value,time:Date.now()});
  msg.value="";
}

function sendTyping(){ db.ref("typing").set(auth.currentUser.email); setTimeout(()=>db.ref("typing").set(""),800); }

db.ref("typing").on("value",s=>{ typing.innerText=s.val()? s.val()+" is typing..." : ""; })

</script>

</body>
</html>
